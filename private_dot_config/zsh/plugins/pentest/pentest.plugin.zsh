#!/usr/bin/env zsh

alias hosts="sudo -Es nvim /etc/hosts"

function hostadd() {
	echo "${BOX}    ${BOXHOST}" | sudo tee -a /etc/hosts
}

function ports() {
	rustscan -b 1000 -a $BOX
}

# -------------------------------------------------

function htbinit() {
	local boxdir="$1"
	local boxip="$2"

	if [[ -z "$boxdir" || -z "$boxip" ]]; then
		echo "Usage: htbinit <boxdir> <boxip>"
		return 1
	fi

	mkdir -p "${boxdir}" || {
		echo "Error: Failed to create directory '$boxdir'"
		return 1
	}

	cat <<-EOF >"${boxdir}/.envrc"
		export ME=\$(ip a s tun0 2>/dev/null | rg -o "10.10\.\d{1,3}\.\d{1,3}" | head -1)
		export BOX="${boxip}"
		export BOXHOST=${boxdir}.htb
	EOF

	cat <<-EOF >"${boxdir}/notes.md"
		# ${boxdir}

		> [!INFO]
		> IP: ${boxip}
		> Hosts: ${boxdir}.htb
		> Flags: 
		>   - User: 
		>   - Root: 


		## Recon
		## Foothold
		## User
		## Root
		## Flags

	EOF

	echo "Initialized HTB box directory: ${boxdir}"
	echo "  IP: ${boxip}"
	echo "  Host: ${boxdir}.htb"
}
